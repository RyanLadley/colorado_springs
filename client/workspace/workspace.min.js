var app=angular.module("app",["ngRoute","ngCookies","mp.datePicker","nvd3"],["$locationProvider",function(a){a.html5Mode(!0)}]);app.run(["$rootScope","$location","$cookies",function(a,b,c){a.$watchCollection(function(){return c.getObject("token")},function(c){null==c?(a.isSignedIn=!1,"/login"!==b.path()&&(alert("You have been logged out!"),b.url("/login"))):a.isSignedIn=!0}),a.$on("$routeChangeStart",function(c,d,e){a.isSignedIn||b.url("/login")})}]),app.service("monthsService",function(){var a=["January","February","March","April","May","June","July","August","September","October","November","December"];this.getMonth=function(b){return a[b]},this.monthList=function(){return a}}),app.service("postRequestService",["$http","$cookies","$location",function(a,b,c){this.request=function(c,d){var e=new FormData;return e.append("payload",JSON.stringify(d)),e.append("token",JSON.stringify(b.getObject("token"))),a.post(c,e,{withCredentials:!1,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(a){if("success"===a.data.status){var c=new Date,d=new Date(c.getFullYear()+1,c.getMonth(),c.getDate());b.putObject("token",a.data.token,{expires:d})}else if("Project Access Denied"===a.data.response){var c=new Date,d=new Date(c.getFullYear()+1,c.getMonth(),c.getDate());b.putObject("token",a.data.token,{expires:d})}else"Invalid User"===a.data.response&&b.remove("token");return a},function(a){"Invalid User"===a.data.response&&b.remove("token")})}}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{controller:"homeController",templateUrl:"/res/site/home/home.index.html"}).when("/login",{controller:"loginController",templateUrl:"/res/site/login/login.index.html"}).when("/overview",{controller:"overviewController",templateUrl:"/res/site/overview/overview.index.html"}).when("/overview/account/:accountId",{controller:"accountController",templateUrl:"/res/site/overview/account.index.html"}).when("/entry",{controller:"dataInputController",templateUrl:"/res/site/data-entry/data-entry.index.html"}).when("/vendors",{controller:"vendorsController",templateUrl:"/res/site/vendors/vendors.index.html"}).when("/vendors/:vendorId",{controller:"vendorDetailsController",templateUrl:"/res/site/vendors/vendor-details.index.html"}).when("/adjustments",{controller:"adjustmentsController",templateUrl:"/res/site/adjustments/adjustments.index.html"}).when("/coversheet",{controller:"coversheetController",templateUrl:"/res/site/coversheet/coversheet.index.html"}).when("/reports",{controller:"reportsController",templateUrl:"/res/site/reports/reports.index.html"}).when("/reports/monthly-expense",{controller:"monthlyExpenseController",templateUrl:"/res/site/reports/monthly-expense.index.html"}).when("/reports/expense-breakdown",{controller:"expenseBreakdownController",templateUrl:"/res/site/reports/expense-breakdown.index.html"}).when("/reports/monthly-breakdown",{controller:"monthlyBreakdownController",templateUrl:"/res/site/reports/monthly-breakdown.index.html"}).when("/profile/:userId",{controller:"profileController",templateUrl:"/res/site/user/profile.index.html"}).when("/administrator/:userId",{controller:"adminController",templateUrl:"/res/site/user/admin.index.html"}).otherwise("/",{redirectTo:"/"})}]),app.filter("dateToISO",function(){return function(a){return iso=a.replace(/(.+) (.+)/,"$1T$2Z"),iso}}),app.filter("percentage",["$filter",function(a){return function(b,c){return a("number")(100*b,c)+"%"}}]),app.controller("accountSelectController",["$scope","$location","postRequestService","monthsService",function(a,b,c,d){a.displaySubaccounts=function(b){a.subaccounts=[],a.shredouts=[],b.sub_accounts.length>0&&(a.subaccounts=b.sub_accounts)},a.displayShredouts=function(b){a.shredouts=[],b&&b.sub_accounts.length>0&&(a.shredouts=b.sub_accounts)},a.asssignReturnId=function(){a.selectedShred&&a.selectedShred.account_id?a.accountId=a.selectedShred.account_id:a.selectedSubaccount&&a.selectedSubaccount.account_id>-1?a.accountId=a.selectedSubaccount.account_id:a.accountId=a.selectedAccount.account_id},a.refreshDisplay=function(){if(a.accounts&&a.accountId)for(var b=!1,c=0;c<a.accounts.length;c++){if(a.accounts[c].account_id==a.accountId){a.selectedAccount=a.accounts[c],a.displaySubaccounts(a.accounts[c]),b=!0;break}for(var d=0;d<a.accounts[c].sub_accounts.length;d++){if(a.accounts[c].sub_accounts[d].account_id==a.accountId){a.selectedAccount=a.accounts[c],a.displaySubaccounts(a.accounts[c]),a.selectedSubaccount=a.accounts[c].sub_accounts[d],a.displayShredouts(a.accounts[c].sub_accounts[d]),b=!0;break}for(var e=0;e<a.accounts[c].sub_accounts[d].sub_accounts.length;e++)if(a.accounts[c].sub_accounts[d].sub_accounts[e].account_id==a.accountId){a.selectedAccount=a.accounts[c],a.displaySubaccounts(a.accounts[c]),a.selectedSubaccount=a.accounts[c].sub_accounts[d],a.displayShredouts(a.accounts[c].sub_accounts[d]),a.selectedShred=a.accounts[c].sub_accounts[d].sub_accounts[e],b=!0;break}if(b)break}if(b)break}}}]),app.controller("accountController",["$scope","$location","$routeParams","postRequestService","monthsService",function(a,b,c,d,e){d.request("/api/accounts/details/"+c.accountId).then(function(b){a.account=b.data.response,a.accountName=f(),a.account.remaining=Number(a.account.total_budget)-Number(a.account.expendetures),a.selectedMonth=g.getMonth(),a.transactions=a.account.monthly_summary[a.selectedMonth],a.months.length<13&&a.months.push("Pending"),h()}),a.displayTransfers=!1,a.buttonMessage="View Transfers",a.getTransfers=function(){a.transfers||d.request("/api/accounts/transfers/"+c.accountId).then(function(b){a.transfers=b.data.response}),a.displayTransfers=!a.displayTransfers,a.displayTransfers?a.buttonMessage="View Transactions":a.buttonMessage="View Transfers"};var f=function(){return"None"!=a.account.shred_no?[a.account.account_no,a.account.sub_no,a.account.shred_no].join("-"):"None"!=a.account.sub_no?[a.account.account_no,a.account.sub_no].join("-"):a.account.account_no},g=new Date;a.months=e.monthList(),a.$watch("selectedMonth",function(){a.transactions&&(a.transactions=a.account.monthly_summary[a.selectedMonth])}),a.monthlyTotals=[];var h=function(){for(var b=0;b<a.months.length;b++){total=0;for(var c=0;c<a.account.monthly_summary[b].length;c++)total+=Number(a.account.monthly_summary[b][c].expense);a.monthlyTotals.push(total)}};a.toggleTransactionDialog=!1,a.displayTransactionDetails=function(b){a.dialogTransaction=b,a.toggleTransactionDialog=!0}}]),app.controller("adjustmentsController",["$scope","$location","postRequestService",function(a,b,c){c.request("/api/dropdown/all").then(function(b){a.accounts=b.data.response.accounts,a.vendors=b.data.response.vendors,a.transactionTypes=b.data.response.transaction_types,a.cityAccounts=b.data.response.city_accounts}),a.display={transactions:!0,pending:!1,budget:!1}}]),app.controller("adminController",["$scope","$location","postRequestService",function(a,b,c){a.users=[{name:"Chuck Chuckers",login:"TheChuck",email:"chuck@email.com",permissions:"2"},{name:"Lama Links",login:"TheRealLama",email:"Lama@email.com",permissions:"1"},{name:"Adminstrator Dan",login:"TrueAdmin2000",email:"admin@email.com",permissions:"0"}],a.submitNewUser=function(){a.newUserForm.$valid?a.newUser.password==a.confirmedPassword?c.request("/api/admin/register",a.newUser).then(function(a){b.url("/")}):a.newUserError="Passwords do not match":a.newUserError="Please fill out all fields"}}]),app.controller("budgetAdjustmentController",["$scope","$location","postRequestService",function(a,b,c){a.submitTransfer=function(){a.transferForm.$valid&&c.request("/api/accounts/transfer",a.transfer).then(function(a){b.url("/")})}}]),app.controller("coversheetController",["$scope","$location","postRequestService",function(a,b,c){c.request("/api/dropdown/all").then(function(b){a.accounts=b.data.response.accounts,a.vendors=b.data.response.vendors,a.transactionTypes=b.data.response.transaction_types,a.pprtaProjects=b.data.response.pprta_projects}),a.display={single:!0,project:!1}}]),app.controller("dataInputController",["$scope","$location","postRequestService",function(a,b,c){c.request("/api/dropdown/all").then(function(b){a.accounts=b.data.response.accounts,a.vendors=b.data.response.vendors,a.transactionTypes=b.data.response.transaction_types,a.cityAccounts=b.data.response.city_accounts}),a.display={transaction:!0,vendor:!1}}]),app.controller("dateSelectController",["$scope","$cookies","$location","postRequestService",function(a,b,c,d){a.$watch("date",function(){a.displayCalendar=!1})}]),app.controller("expenseBreakdownController",["$scope",function(a){a.options={chart:{type:"pieChart",height:500,x:function(a){return a.key},y:function(a){return a.percentage},showLabels:!0,duration:500,labelThreshold:.01,labelSunbeamLayout:!0,legend:{margin:{top:5,right:35,bottom:5,left:0}},tooltip:{valueFormatter:function(a){return d3.format(",.2f")(a)}}}},a.data=[{key:522100,percentage:30,value:23440.43},{key:522200,percentage:10,value:13440.43},{key:522300,percentage:20,value:23540.43},{key:522400,percentage:15,value:3440.43},{key:522500,percentage:15,value:23430.43}],a.overviewSelected=!0,a.viewFilters=[{account:52100,selected:!1},{account:52200,selected:!1},{account:52300,selected:!1},{account:52400,selected:!1},{account:52500,selected:!1}],a.filterSelect=function(a){}}]),app.controller("homeController",["$scope","$cookies","$location","postRequestService",function(a,b,c,d){a.logout=function(){b.remove("token")},a.getGreeting=function(){var a=new Date;return hour=a.getHours(),hour<12?"Morning":hour<17?"Afternoon":"Evening"},d.request("/api/user/basics").then(function(b){a.user=b.data.response})}]),app.controller("loginController",["$scope","$location","postRequestService",function(a,b,c){a.login={},a.submit=function(){e()&&d()&&c.request("/api/admin/login",a.login).then(function(c){"success"===c.data.status?b.url("/"):a.failureMessage=c.data.response})};var d=function(){return!(!a.login.password||a.login.password.length<6)||(a.failureMessage="Password must be at least 6 characters",!1)},e=function(){return!(!a.login.email||!a.loginForm.loginEmail.$valid)||(a.failureMessage="The email address provided is invalid",!1)}}]),app.controller("monthlyBreakdownController",["$scope","$location",function(a,b){a.options={chart:{type:"multiBarChart",height:450,stacked:!0,margin:{top:20,right:20,bottom:60,left:65},x:function(a){return a.month},y:function(a){return a.amount},useInteractiveGuideline:!0,forceY:[0,2e4],color:d3.scale.category10().range(),duration:300,xAxis:{axisLabel:"Month",showMaxMin:!1,tickFormat:function(b){return a.months[b]}},yAxis:{axisLabel:"Amount",axisLabelDistance:20,tickFormat:function(a){return"$"+d3.format(",.2f")(a)}},tooltip:{valueFormatter:function(a){return"$"+d3.format(",.2f")(a)}}}},a.months=["Janary","February","March","April","May","June","July","August","September","October","November","December"],a.data=[{key:"522000-1",values:[{month:0,amount:3e3},{month:1,amount:4356},{month:2,amount:1009},{month:3,amount:3e3},{month:4,amount:4356},{month:5,amount:1009},{month:6,amount:3e3},{month:7,amount:4346},{month:8,amount:1009},{month:9,amount:2e3},{month:10,amount:4356},{month:11,amount:1009}]},{key:"522000-2",values:[{month:0,amount:2e3},{month:1,amount:14656},{month:2,amount:21409},{month:3,amount:2e4},{month:4,amount:10356},{month:5,amount:1009},{month:6,amount:12300},{month:7,amount:1106},{month:8,amount:279},{month:9,amount:24e3},{month:10,amount:12356},{month:11,amount:1009}]},{key:"522000-3",values:[{month:0,amount:300},{month:1,amount:956},{month:2,amount:2109},{month:3,amount:200},{month:4,amount:1056},{month:5,amount:1009},{month:6,amount:1900},{month:7,amount:1136},{month:8,amount:909},{month:9,amount:24e3},{month:10,amount:12356},{month:11,amount:1e3}]}],a.overviewSelected=!0,a.viewFilters=[{account:52100,selected:!1},{account:52200,selected:!1},{account:52300,selected:!1},{account:52400,selected:!1},{account:52500,selected:!1}],a.filterSelect=function(a){}}]),app.controller("monthlyExpenseController",["$scope","$location","monthsService",function(a,b,c){a.months=function(a){return c.getMonth(a)},a.options={chart:{type:"lineChart",height:450,margin:{top:20,right:20,bottom:60,left:65},x:function(a){return a.month},y:function(a){return a.amount},useInteractiveGuideline:!0,forceY:[0,2e4],color:d3.scale.category10().range(),duration:300,xAxis:{axisLabel:"Month",showMaxMin:!1,staggerLabels:!0,tickFormat:function(b){return a.months(b)}},yAxis:{axisLabel:"Amount",axisLabelDistance:20,tickFormat:function(a){return"$"+d3.format(",.2f")(a)}}}},a.data=[{key:"Budget",values:[{month:0,amount:23e3},{month:1,amount:14356},{month:2,amount:21009},{month:3,amount:23e3},{month:4,amount:14356},{month:5,amount:11009},{month:6,amount:23e3},{month:7,amount:14356},{month:8,amount:21009},{month:9,amount:23e3},{month:10,amount:14356},{month:11,amount:11009}]},{key:"Actual",values:[{month:0,amount:21e3},{month:1,amount:14656},{month:2,amount:21409},{month:3,amount:2e4},{month:4,amount:10356},{month:5,amount:12009},{month:6,amount:19e3},{month:7,amount:11356},{month:8,amount:23009},{month:9,amount:24e3},{month:10,amount:12356},{month:11,amount:10009}]}],a.overviewSelected=!0,a.viewFilters=[{account:52100,selected:!1},{account:52200,selected:!1},{account:52300,selected:!1},{account:52400,selected:!1},{account:52500,selected:!1}],a.filterSelect=function(a){}}]),app.controller("overviewController",["$scope","$location","postRequestService",function(a,b,c){a.expandAll=function(){for(var b=0;b<a.accounts.length;b++){a.accounts[b].showSubaccount=!0;for(var c=0;c<a.accounts[b].sub_accounts.length;c++)a.accounts[b].sub_accounts[c].showSubaccount=!0}},a.collapseAll=function(){for(var b=0;b<a.accounts.length;b++){a.accounts[b].showSubaccount=!1;for(var c=0;c<a.accounts[b].sub_accounts.length;c++)a.accounts[b].sub_accounts[c].showSubaccount=!1}},c.request("/api/accounts/overview").then(function(b){a.accounts=b.data.response})}]),app.controller("pendingAdjustmentController",["$scope","$location","postRequestService",function(a,b,c){a.pendingDisplay=function(){a.pendingExpand=!a.pendingExpand,a.pendingExpand?(a.pendingSetPos={left:"0"},a.pendingSelectPos={left:"-1700px"}):(a.pendingSelectPos={left:"0"},a.pendingSetPos={left:"1700px"})},a.$watch("vendorId",function(){a.vendorId&&c.request("/api/transaction/pending/vendor/"+a.vendorId).then(function(b){a.pending=b.data.response})}),a.selectedPending=-1,a.setSelectedPendingTransaction=function(){a.selectedTransaction={transactionId:a.pending[a.selectedPending].transaction_id,accountId:a.pending[a.selectedPending].account_id,vendorId:a.pending[a.selectedPending].vendor_id,invoiceDate:a.pending[a.selectedPending].invoice_date,invoiceNo:a.pending[a.selectedPending].invoice_no,transactionTypeId:Number(a.pending[a.selectedPending].transaction_type_id),description:a.pending[a.selectedPending].description,expense:Number(a.pending[a.selectedPending].expense)}},a.submitPending=function(){a.pendingForm.$valid&&c.request("/api/transaction/pending/update",a.selectedTransaction).then(function(a){b.url("/")})}}]),app.controller("profileController",["$scope","$location",function(a,b){a.user={name:"FirstName LastName",phoneNumber:"719-555-9876",email:"user@email.com",login:"Username64"}}]),app.controller("projectCoversheetController",["$scope","$location","$window","postRequestService",function(a,b,c,d){a.page=1,a.incrementPage=function(){a.page++},a.decrementPage=function(){a.page--},a.navLocation=function(b){return b<a.page?"nav-left":b>a.page?"nav-right":"nav-display"},a.coversheet={pprtaAccountCodeId:null,vendorId:null,transactions:[]},a.searchInvoice=function(){(a.search.vendorId||a.search.invoiceNo||a.search.pprtaAccountCodeId)&&d.request("/api/transaction/invoice/search",a.search).then(function(b){a.transactions=b.data.response,a.coversheet.pprtaAccountCodeId&&(e(),f())})},a.createProjectCoversheet=function(){d.request("/api/coversheet/project",a.coversheet).then(function(a){c.open("/coversheet/project/"+a.data.response)})},a.disableCreate=!0,a.evaluateRows=function(b){if(b.selected)a.disableCreate=!1,a.coversheet.transactions.push(b),a.coversheet.pprtaAccountCodeId||(a.coversheet.pprtaAccountCodeId=b.pprta_account_code_id,a.coversheet.vendorId=b.vendor_id,e());else if(g(),a.coversheet.transactions.length<=0){h();for(var c=0;c<a.transactions.length;c++)a.transactions[c].disabled=!1}};var e=function(){for(var b=0;b<a.transactions.length;b++)a.transactions[b].pprta_account_code_id==a.coversheet.pprtaAccountCodeId&&a.transactions[b].vendor_id==a.coversheet.vendorId||(a.transactions[b].disabled=!0)},f=function(){for(var b=0;b<a.transactions.length;b++)for(var c=0;c<a.coversheet.transactions.length;c++)if(a.transactions[b].transaction_id==a.coversheet.transactions[c].transaction_id){a.transactions[b].selected=!0;break}},g=function(){for(var b=0;b<a.transactions.length;b++)for(var c=0;c<a.coversheet.transactions.length;c++)if(a.transactions[b].transaction_id==a.coversheet.transactions[c].transaction_id){a.coversheet.transactions.splice(c,1),b=a.transactions.length;break}},h=function(){a.coversheet.pprtaAccountCodeId=null,a.coversheet.vendorId=null,a.disableCreate=!0}}]),app.controller("reportsController",["$scope","$location",function(a,b){a.reports=[{name:"Monthly Expense",link:"monthly-expense"},{name:"Expense Breakdown",link:"expense-breakdown"},{name:"Monthly Breakdown",link:"monthly-breakdown"}]}]),app.controller("sidebarController",["$scope","$location",function(a,b){a.icons={overview:!1,entry:!1,reports:!1,vendors:!1,adjustments:!1},a.expand=!1,a.toggleExpand=function(){a.expand=!a.expand,a.expand?(a.pos={width:"200px"},a.abs={left:"0"}):(a.pos={width:"50"},a.abs={left:"-200"})},a.$watch(function(){return b.path()},function(b){angular.forEach(a.icons,function(b,c){a.icons[c]=!1}),"/"===b?a.icons.home=!0:/\/overview*/.test(b)?a.icons.overview=!0:/\/entry*/.test(b)?a.icons.entry=!0:/\/reports*/.test(b)?a.icons.reports=!0:/\/vendors*/.test(b)?a.icons.vendors=!0:/\/adjustments*/.test(b)&&(a.icons.adjustments=!0)})}]),app.controller("singleCoversheetController",["$scope","$location","$window","postRequestService",function(a,b,c,d){a.search={invoiceNo:null},a.searchInvoice=function(){(a.search.vendorId||a.search.invoiceNo)&&(e(),d.request("/api/transaction/invoice/search",a.search).then(function(b){b.data.response.length?a.transactions=b.data.response:a.transactions=!1}))},a.createSingleCoversheet=function(){a.invoice.transactionIds=[];for(var b=0;b<a.transactions.length;b++)a.transactions[b].selected&&a.invoice.transactionIds.push(a.transactions[b].transaction_id);d.request("/api/coversheet/single",a.invoice).then(function(a){c.open("/coversheet/project/"+a.data.response)})},a.invoice={invoiceNo:null,vendorId:null},a.disableCreate=!0,a.disableRows=function(b){if(b.selected){if(a.disableCreate=!1,!a.invoice.invoiceNo){a.invoice.invoiceNo=b.invoice_no,a.invoice.vendorId=b.vendor_id;for(var c=0;c<a.transactions.length;c++)a.transactions[c].invoice_no==a.invoice.invoiceNo&&a.transactions[c].vendor_id==a.invoice.vendorId||(a.transactions[c].disabled=!0)}}else{for(var d=!1,c=0;c<a.transactions.length;c++)if(a.transactions[c].selected){d=!0;break}if(!d){e();for(var c=0;c<a.transactions.length;c++)a.transactions[c].disabled=!1}}};var e=function(){a.invoice.invoiceNo=null,a.invoice.vendorId=null,a.disableCreate=!0}}]),app.controller("transactionAdjustmentController",["$scope","$location","postRequestService","monthsService",function(a,b,c,d){a.accountId=null,a.page=1,a.incrementPage=function(){a.page++},a.decrementPage=function(){a.page--},a.navLocation=function(b,c){return c<a.page?"nav-left":b>a.page?"nav-right":"nav-display"},a.selectedIndex=-1,a.setSelectedTransaction=function(){a.selectedTransaction={transactionId:a.account.monthly_summary[a.selectedMonth][a.selectedIndex].transaction_id,accountId:a.account.monthly_summary[a.selectedMonth][a.selectedIndex].account_id,vendorId:a.account.monthly_summary[a.selectedMonth][a.selectedIndex].vendor_id,invoiceDate:a.account.monthly_summary[a.selectedMonth][a.selectedIndex].invoice_date,datePaid:a.account.monthly_summary[a.selectedMonth][a.selectedIndex].date_paid,invoiceNo:a.account.monthly_summary[a.selectedMonth][a.selectedIndex].invoice_no,transactionTypeId:Number(a.account.monthly_summary[a.selectedMonth][a.selectedIndex].transaction_type_id),description:a.account.monthly_summary[a.selectedMonth][a.selectedIndex].description,expense:Number(a.account.monthly_summary[a.selectedMonth][a.selectedIndex].expense)},c.request("/api/transaction/city-account-assignments/"+a.selectedTransaction.transactionId).then(function(b){var c=b.data.response;if(c.length>0){a.selectedTransaction.cityAccounts=[];for(var d=0;d<c.length;d++)a.selectedTransaction.cityAccounts.push({cityAccountAssignmentId:c.city_account_assignment_id,amount:parseFloat(c[d].amount),cityAccountId:c[d].city_account_id})}})},a.$watch("accountId",function(){a.accountId&&c.request("/api/transaction/account/"+a.accountId).then(function(b){a.account=b.data.response})});var e=new Date;a.months=d.monthList(),a.selectedMonth=e.getMonth(),a.$watch("selectedMonth",function(){a.transactions&&(a.transactions=a.account.monthly_summary[a.selectedMonth])})}]),app.controller("transactionDialogController",["$scope","$window","postRequestService",function(a,b,c){a.exit=function(){a.display=!1},a.$watch("display",function(){a.display&&c.request("/api/transaction/details/"+a.transactionId).then(function(b){a.transaction=b.data.response})}),a.createSingleCoversheet=function(){a.invoice={invoiceNo:a.transaction.invoice_no,vendorId:a.transaction.vendor_id,description:a.transaction.description,transactionIds:[a.transaction.transaction_id]},c.request("/api/coversheet/single",a.invoice).then(function(a){b.open("/coversheet/single-invoice/"+a.data.response)})}}]),app.controller("transactionEntryController",["$scope","$location","postRequestService",function(a,b,c){void 0==a.firstpage&&(a.firstpage=1),void 0==a.page&&(a.page=a.firstpage),a.incrementPage=function(){a.page++},a.decrementPage=function(){a.page--},a.navLocation=function(b,c){if(b<a.page)return"nav-left";if(b>a.page){if(c)return"nav-right"}else{if(!a.transaction)return"nav-display";if(!a.transaction.transactionId||c)return"nav-display"}},a.submitTransaction=function(){a.entryForm.$valid&&a.remaining>=-.005&&(a.transaction.transactionId?c.request("/api/transaction/update",a.transaction).then(function(a){b.url("/")}):c.request("/api/transaction/new",a.transaction).then(function(a){b.url("/")}))},a.setupCityAccounts=function(){!a.transaction.cityAccounts||a.startExpense&&a.startExpense!=a.transaction.expense?(a.remaining=0,a.startExpense=a.transaction.expense,a.transaction.cityAccounts=[{cityAccountId:"",amount:a.transaction.expense}]):a.checkRemaining()},a.checkRemaining=function(){var b=0;for(i=0;i<a.transaction.cityAccounts.length;i++)b+=a.transaction.cityAccounts[i].amount;a.remaining=Number((a.transaction.expense-b).toFixed(2))},a.addAccount=function(){for(i=0;i<a.transaction.cityAccounts.length;i++)0==a.transaction.cityAccounts[i].amount&&""===a.transaction.cityAccounts[i].cityAccountId&&(a.transaction.cityAccounts.splice(i,1),i--);a.remaining>0&&(a.transaction.cityAccounts.push({cityAccountId:"",amount:a.remaining}),a.checkRemaining())}}]),app.controller("vendorDetailsController",["$scope","$location","$routeParams","postRequestService",function(a,b,c,d){d.request("/api/vendor/details/"+c.vendorId).then(function(b){a.vendor=b.data.response,a.total_expense=0;for(var c=0;c<a.vendor.transactions.length;c++)a.total_expense+=Number(a.vendor.transactions[c].expense)}),a.toggleTransactionDialog=!1,a.displayTransactionDetails=function(b){a.dialogTransaction=b,a.toggleTransactionDialog=!0}}]),app.controller("vendorEntryController",["$scope","$location","postRequestService",function(a,b,c){a.submitVendor=function(){c.request("/api/vendor/new",a.vendor).then(function(a){b.url("/")})}}]),app.controller("vendorsController",["$scope","$location","postRequestService",function(a,b,c){c.request("/api/vendor/listing").then(function(b){a.vendors=b.data.response})}]),app.directive("accountName",function(){return{restrict:"E",scope:{accountId:"<",accountNo:"<",subNo:"<",shredNo:"<"},template:"<a class = 'account-link' href = '/overview/account/{{accountId}}'>{{accountName}}</a>",link:function(a){a.name="","None"!=a.shredNo?a.accountName=a.accountNo.toString()+"-"+a.subNo.toString()+"-"+a.shredNo.toString():"None"!=a.subNo?a.accountName=a.accountNo.toString()+"-"+a.subNo.toString():a.accountName=a.accountNo.toString()}}}),app.directive("accountSelect",function(){return{restrict:"E",controller:"accountSelectController",scope:{accounts:"<?",accountId:"="},templateUrl:"/res/components/directives/account-select/account-select.template.html",link:function(a){a.$watch("accountId",function(){a.refreshDisplay()})}}}),app.directive("budgetAdjustment",function(){return{restrict:"E",controller:"budgetAdjustmentController",templateUrl:"/res/components/directives/adjustments/budget-adjustment.template.html"}}),app.directive("pendingAdjustment",function(){return{restrict:"E",controller:"pendingAdjustmentController",templateUrl:"/res/components/directives/adjustments/pending-adjustment.template.html"}}),app.directive("transactionAdjustment",function(){return{restrict:"E",controller:"transactionAdjustmentController",templateUrl:"/res/components/directives/adjustments/transaction-adjustment.template.html"}}),app.directive("projectCoversheet",function(){return{restrict:"E",controller:"projectCoversheetController",scope:{pprtaProjects:"<",vendors:"<"},templateUrl:"/res/components/directives/coversheets/project-coversheet.template.html"}}),app.directive("singleCoversheet",function(){return{restrict:"E",controller:"singleCoversheetController",templateUrl:"/res/components/directives/coversheets/single-coversheet.template.html"}}),app.directive("dateSelect",function(){return{restrict:"E",controller:"dateSelectController",scope:{date:"=",required:"@?",inputDisabled:"@?",label:"@",info:"@?"},templateUrl:"/res/components/directives/date-select/date-select.template.html"}}),app.directive("fileUpload",function(){return{restrict:"A",scope:{file:"="},link:function(a,b,c){var d=new FileReader;d.onload=function(b){a.file=b.target.result,a.$apply()},b.on("change",function(){d.readAsDataURL(b[0].files[0])})}}}),app.directive("infoTip",function(){return{restrict:"E",scope:{message:"@"},template:'<div class = "info"><i class = "fa fa-info-circle"></i><div class = "infotext">{{message}}</div></div>'}}),app.directive("searchField",function(){return{restrict:"E",scope:{label:"@",model:"=?",function:"=?"},templateUrl:"/res/components/directives/search-field/search-field.template.html"}}),app.directive("sidebarInfo",function(){return{restrict:"E",templateUrl:"/res/components/directives/sidebar/sidebar-info.template.html"}}),app.directive("sidebar",function(){return{restrict:"E",controller:"sidebarController",scope:{card:"="},templateUrl:"/res/components/directives/sidebar/sidebar.template.html"}}),app.directive("transactionDialog",function(){return{restrict:"E",controller:"transactionDialogController",scope:{transactionId:"=transaction",display:"="},templateUrl:"/res/components/directives/transaction-dialog/transaction-dialog.template.html"}}),app.directive("transactionEntry",function(){return{restrict:"E",controller:"transactionEntryController",scope:{transaction:"=",vendors:"<vendorOptions",accounts:"<accountOptions",transactionTypes:"<transactionTypeOptions",cityAccounts:"<cityAccountOptions",firstpage:"<?",page:"=?",submit:"="},templateUrl:"/res/components/directives/transaction-entry/transaction-entry.template.html"}}),app.directive("vendorEntry",function(){return{restrict:"E",controller:"vendorEntryController",scope:{vendor:"=",submit:"="},templateUrl:"/res/components/directives/vendor-entry/vendor-entry.template.html"}});